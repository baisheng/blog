---
title: 后端密码设计最佳实践的思考
date: 2018-11-24 19:00:00
tags: [数据库]
---

数据库设计当中, 用户表中的密码设计是无法避免的, 即使是完全依赖 OAuth 来登录, 也难免需要密码登录的场景. 以下根据我的开发经验, 我来讲几个我认为的密码设计最佳实践.

## 使用哈希

稍微有点经验的开发者都知道不能将明文密码存储在数据库当中, 因为一旦数据库发生泄漏, 对于用户的隐私会造成巨大的威胁.

所以我们需要使用**单向哈希函数**对密码进行加密后再存储在数据库, 这样处理之后的密码是不可还原的, 也就杜绝了他人拿到密码之后对密码进行还原.

$hashed\_pwd= hash(pwd)$

### 给哈希加料

不过仅仅进行哈希, 还是不够安全. 由于[彩虹表](https://zh.wikipedia.org/zh-hans/%E5%BD%A9%E8%99%B9%E8%A1%A8)的存在, 在拿到哈希密码之后, 一些常见密码依旧可能会还原出来. 所以我们就需要让哈希前的密码没有那么简单. 那就是**加盐**, 即在原始密码后方加入一串字符串, 降低密码被碰撞出来的概率.

$hashed\_pwd = hash(pwd+salt)$

当让, 为了让密码更加安全, 可以进行多次哈希 

$hashed\_pwd = hash(hash(pwd)+salt)$

但是还是存在一个问题, 就是加入数据库和 salt 同时泄露, 黑客就可以根据这个 salt 再生成一个哈希字典, 进行还原密码. 

所以, 开发的时候对于每一个密码, 都要有一个独立的 salt, 这样即使泄露了, 黑哥对于每一个 salt 都要单独创建一个哈希字典, 这使破解密码成为几乎不可能. 

### 字段设计

| id:int | username:varchar(255) | hash_pwd:char(64)                                            | hash_salt:char(8) |
| ------ | --------------------- | ------------------------------------------------------------ | ----------------- |
| 3452   | my_username           | 7256d8d7741f740ee83ba7a9b30e7ac11fcd9dbd7a0147f4cc83c62dd6e0c45b | -0xT!sp9          |

由于哈希函数输出结果有固定的长度, pwd 可以直接设为定长字符串

salt 越长越复杂, 在一定程度上越能保证安全性, 但是要在性能和安全性上找到一个平衡点, 可以将 salt 设定为 5~10 个字节之间, 我这里设为 8 个字节

### 哈希算法选择

常用的哈希算法有很多, 比如 `SHA-256`, `sha-512`, `MD5`, 

## 重置密码设计



## 前后端密码传输

一般来说, 前后端交互中, 服务端只使用 session 或者 token 来鉴权, 而不是每一次请求都将账户密码放在 header 中. 所以需要前端向后端传输密码的场景仅仅是第一次登录授权的时候.

使用 **HTTPS**, 