<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 记一次 GitHub Pages 部署 · SorcererXW's Blog</title><meta name="description" content="记一次 GitHub Pages 部署 - SorcererXW"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.sorcererxw.com/atom.xml" title="SorcererXW's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/sorcererxw" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">记一次 GitHub Pages 部署</h1><div class="post-info">Aug 9, 2018</div><div class="post-content"><p>之前买了一个域名 <a href="https://ilove.works" target="_blank" rel="noopener">ilove.works</a>，用 React 写了一个小玩具。本来打算放在自己的服务器里面，但是想想这只是一个小玩具，放在自己服务器里面只会让未来的维护成本上升。好吧，那就放在 GitHub Pages 上吧。毕竟 React 官方的 create-react-app 能够搭配 gh-pages 非常舒服地进行部署。</p>
<a id="more"></a>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><p>之前只使用 pages 部署过个人主页，没有部署过独立地项目主页。整个过程参考了<a href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#github-pages" target="_blank" rel="noopener">create-react-app 文档</a>，但是还是踩了一些坑，复盘记录一下步骤。</p>
<h2 id="集成-gh-pages"><a href="#集成-gh-pages" class="headerlink" title="集成 gh-pages"></a>集成 gh-pages</h2><p>写完代码，本地测试完毕，准备部署了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev gh-pages</span><br></pre></td></tr></table></figure></p>
<p>并在 <code>packages.json</code> 的 <code>scripts</code> 节点当中添加两句命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">+   &quot;predeploy&quot;: &quot;npm run build&quot;,</span><br><span class="line">+   &quot;deploy&quot;: &quot;gh-pages -d build&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;react-scripts start&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;react-scripts build&quot;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>部署的时候只需要直接执行 <code>deploy</code> 命令，<code>predeploy</code> 会在不部署前被自动调用执行的。</p>
<h2 id="配置主页地址"><a href="#配置主页地址" class="headerlink" title="配置主页地址"></a>配置主页地址</h2><p>在 <code>packages.json</code> 根节点当中添加一行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;homepage&quot;: &quot;https:/example.github.io/&quot;,</span><br></pre></td></tr></table></figure></p>
<h3 id="坑点"><a href="#坑点" class="headerlink" title="坑点"></a>坑点</h3><p>这里和文档当中不一样，文档当中是添加 <code>&quot;homepage&quot;: &quot;https:/example.github.io/app&quot;</code>，如果根据文档上的部署，的确能够正确地将项目部署上去，访问地址就是 <code>example.github.io/app</code>，但是如果之后再配置域名，访问地址也会是 <code>example.com/app</code>，而我们需要的是直接访问自定义域名，而不是其中一个子目录。<br>我折腾了半天才发现，因为在我配置完自定义域名后，打开自定义域名会一直显示资源文件404，只有手动在地址栏里面输入 ‘ilove.works/iloveworks’ 才可以访问，这显然很愚蠢。</p>
<h2 id="配置自定义域名"><a href="#配置自定义域名" class="headerlink" title="配置自定义域名"></a>配置自定义域名</h2><p>这很简单，直接根据 GitHub Pages 下面的说明，在设置里面填入你的域名或者手动把 CNAME 文件放在你的项目 public 目录下面。<br>然后需要把 DNS 解析到 GitHub Pages。常见的作法就是直接添加 A记录和 CNAME alias。我添加了 4 个 A 记录<br>185.199.108.153<br>185.199.109.153<br>185.199.110.153<br>185.199.111.153</p>
<p>可以正常访问了，但是 GitHub Pages 设置面板里面一直显示 <code>Unavailable for your site because your domain is not properly configured to support HTTPS</code>，即无法启用 GP 的 <code>enforce Https</code>，怎么会这样。Google 了一圈，都找不到合适的解释。<br>因为能够正常解析，所以我一直没有意识到是 DNS 的问题。但最终我发现确实是 DNS 的问题。因为我使用的 Cloudflare 的解析服务，但是 Cloudflare 会默认给域名套上 CDN，导致直接查询域名的主机地址是 Cloudflare 的 CDN 服务器，而不是 Github Pages。所以，Github 才认为我并没有配置好解析，也无法进行下一步。<br><img src="https://wx2.sinaimg.cn/mw690/86dfa6f4gy1ftjv23wahnj208206ujrh.jpg" alt="img"><br>解决方法很简单，单击那个云变成 <code>dns only</code> 即可。<br><img src="https://wx1.sinaimg.cn/mw690/86dfa6f4gy1ftjv3hdlyej20xh0csta8.jpg" alt="img"><br>当然，cloudflare 的这个功能这个能够保护主机真实地址，但是毕竟是放在 Github 的主机里面，也不用在乎这些了。</p>
<p>最后检查域名地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dig +noall +answer example.com</span><br><span class="line">;example.com.</span><br><span class="line">example.com.   3600  IN  A 185.199.108.153</span><br><span class="line">example.com.   3600  IN  A 185.199.109.153</span><br><span class="line">example.com.   3600  IN  A 185.199.110.153</span><br><span class="line">example.com.   3600  IN  A 185.199.111.153</span><br></pre></td></tr></table></figure></p>
<p>好了，一波配置之后，删除 Github Pages 上原来的自定义域名设置，然后重新添加一下。发现 Github 提示说要等待一段时间来进行证书申请。等几十分钟，就可以勾选 <code>enforce https</code> 了。</p>
<h2 id="最终的效果"><a href="#最终的效果" class="headerlink" title="最终的效果"></a>最终的效果</h2><p>访问 <code>ilove.works</code> 可以直接访问项目。<br>访问 <code>sorcererxw.github.io</code> 是自己的主页项目（如果没有就是404）<br>访问 <code>sorcererxw.github.io/iloveworks</code> 会自动跳转到 <code>ilove.works</code></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/08/10/nginx-reverse-proxy-github-page-api-gateway/" class="prev">上一篇</a><a href="/2016/11/25/android-cardify/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'sorcererxwblog';
var disqus_identifier = '2018/08/09/deploy-github-pags/';
var disqus_title = '记一次 GitHub Pages 部署';
var disqus_url = 'http://blog.sorcererxw.com/2018/08/09/deploy-github-pags/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//sorcererxwblog.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2018 <a href="http://blog.sorcererxw.com">SorcererXW</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>